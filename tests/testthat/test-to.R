test_weighted <- data.frame(
  source = c("A","A", "A", "A", "A","J", "B", "B", "C", "C", "D","I"),
  target = c("B","B", "C", "D", "J","A","E", "F", "G", "H", "I","I"),
  weight = sample(1:20, 12, replace = T)
)
test_unweighted <- data.frame(
  source = c("A","A", "A", "A", "A","J", "B", "B", "C", "C", "D","I"),
  target = c("B","B", "C", "D", "J","A","E", "F", "G", "H", "I","I")
)

simple_edge_df_weighted <- data.frame(
  from = c("b", "c", "c", "d", "a"),
  to = c("a", "b", "a", "a", "b"),
  weight = c(1, 1, 2, 2, 3)
)

simple_edge_df_unweighted <- data.frame(
  from = c("b", "c", "c", "d", "a"),
  to = c("a", "b", "a", "a", "b")
)

test_that("to_unweight works", {
  expect_equal(to_unweighted(matrix(0:8,3,3)), matrix(c(0, rep(1,8)),3,3))
  expect_equal(to_unweighted(ison_southern_women), ison_southern_women)
  expect_equal(c(to_unnamed(as_matrix(to_unweighted(to_mode1(ison_southern_women)))))[1:4],
               c(0,1,1,1))
  expect_equal(c(to_unweighted(as_tidygraph(test_weighted)))[8],
               c(as_tidygraph(test_unweighted))[8])
  expect_equal(to_unweighted(as_network(simple_edge_df_weighted)),
                as_network(simple_edge_df_unweighted))
})

unnamedsouthern <- igraph::remove.vertex.attribute(ison_southern_women, "name")
test_unnamed <- igraph::remove.vertex.attribute(as_tidygraph(test_weighted),
                                                "name")
test_that("to_unnamed works",{
  expect_equal(to_unnamed(ison_southern_women), 
               igraph::remove.vertex.attribute(ison_southern_women, "name"))
  expect_equal(to_unnamed(igraph::remove.vertex.attribute(ison_southern_women, "name")),
               igraph::remove.vertex.attribute(ison_southern_women, "name"))
  expect_equal(c(to_unnamed(as_tidygraph(test_weighted)))[8], c(test_unnamed)[8])
  expect_equal(to_unnamed(as_network(ison_southern_women)),
               network::delete.vertex.attribute(as_network(ison_southern_women), "vertex.names"))
  expect_equal(c(as_matrix(to_unnamed(as_igraph(ison_algebra_class)))),
               c(as_matrix(as_igraph(ison_algebra_class))))
  expect_equal(to_unnamed(test_unweighted),
               structure(list(source = c(1L, 1L, 1L, 1L, 1L, 2L, 3L, 3L, 4L, 4L, 5L, 6L),
                              target = c(3L, 3L, 4L, 5L, 2L, 1L, 7L, 8L, 9L, 10L, 6L, 6L)),
                         row.names = c(NA, -12L), class = c("tbl_df", "tbl", "data.frame")))
})

names_southern <- igraph::get.vertex.attribute(ison_southern_women, "name")

test_that("to_named works", {
  expect_equal(to_named(ison_southern_women, names_southern), ison_southern_women)
})

test_that("to_undirected works",{
  expect_equal(c(to_undirected(as_igraph(ison_algebra_class)))[3], 
               c(igraph::as.undirected(ison_algebra_class, edge.attr.comb = "first"))[3])
  expect_equal(as_matrix(to_undirected(as_tidygraph(test_weighted))),
               as_matrix(igraph::as.undirected(as_tidygraph(test_weighted),edge.attr.comb = "first")))
  expect_equal(to_undirected(as_matrix(ison_adolescent_friends)),
               ((as_matrix(ison_adolescent_friends) + t(as_matrix(ison_adolescent_friends))) > 0) * 1)
  expect_equal(to_undirected(as_matrix(ison_southern_women)),
               as_matrix(ison_southern_women))
  expect_equal(as_matrix(to_undirected(as_network(ison_adolescent_friends))),
               as_matrix(to_undirected(ison_adolescent_friends)))
})

test_that("to_onemode works",{
  expect_equal(c(to_onemode(ison_marvel_teams))[3], c(igraph::delete_vertex_attr(ison_marvel_teams, "type"))[3])
  expect_equal(as_matrix(to_onemode(as_tidygraph(ison_marvel_teams))),
               as_matrix(as_tidygraph(igraph::delete_vertex_attr(ison_marvel_teams, "type"))))
})

comps <- igraph::components(ison_marvel_teams)
max.comp <- which.max(ison_marvel_teams$csize)
test <- igraph::delete.vertices(ison_marvel_teams, comps$membership != max.comp)

test_that("to_main_component works",{
  expect_equal(as_matrix(to_main_component(ison_marvel_teams)), as_matrix(test))
  expect_equal(as_matrix(to_main_component(as_tidygraph(ison_marvel_teams))),
               as_matrix(test))
})

out <- igraph::delete_edges(ison_algebra_class,
                            igraph::E(ison_algebra_class)[igraph::get.edge.attribute(ison_algebra_class, "friend_tie") == 0])
edge_names <- igraph::edge_attr_names(ison_algebra_class)
if (length(edge_names) > 1) {
  for (e in setdiff(edge_names, "friend_tie")) {
    out <- igraph::delete_edge_attr(out, e) 
  }
}
if (is.numeric(igraph::get.edge.attribute(ison_algebra_class, "friend_tie"))) names(igraph::edge_attr(out)) <- "weight"

test_that("to_uniplex works", {
  expect_equal(as_matrix(to_uniplex(ison_algebra_class, "friend_tie")), as_matrix(out))
  expect_equal(as_matrix(to_uniplex(as_tidygraph(ison_algebra_class), "friend_tie")), as_matrix(out))
})

test_that("to_simplex works", {
  expect_equal(as_matrix(to_simplex(ison_algebra_class)), as_matrix(ison_algebra_class))
})

testunsigned <- igraph::delete_edges(ison_marvel_relationships, which(igraph::E(ison_marvel_relationships)$sign < 0))
testunsigned2 <- igraph::delete_edges(ison_algebra_class, which(igraph::E(ison_algebra_class)$sign < 0))
testunsigned3 <- igraph::delete_edges(ison_algebra_class, which(igraph::E(ison_algebra_class)$sign > 0))

test_that("to_unsigned works", {
  expect_equal(c(as_matrix(to_unsigned(ison_marvel_relationships, "positive"))),
               c(as_matrix(testunsigned)))
  expect_equal(c(as_matrix(to_unsigned(ison_algebra_class, "positive"))),
               c(as_matrix(testunsigned2)))
  expect_equal(c(as_matrix(to_unsigned(ison_algebra_class, "negative"))),
               c(as_matrix(testunsigned3)))
})

testnamed <- ison_algebra_class
igraph::V(testnamed)$name  <- sample(baby_names,
                                     igraph::vcount(testnamed))
test_that("to_named works", {
  expect_equal(c(as_matrix(to_named(ison_algebra_class))), c(as_matrix(testnamed)))
  expect_equal(c(as_matrix(to_named(as_igraph(ison_algebra_class)))), c(as_matrix(testnamed)))
})

testmultilevel <- mpn_elite_usa_advice
igraph::V(testmultilevel)$lvl <- ifelse(igraph::V(testmultilevel)$type, 2, 1)
testmultilevel <- igraph::delete_vertex_attr(testmultilevel, "type")
test_that("multilevel works", {
  expect_equal(to_multilevel(mpn_elite_usa_advice), testmultilevel)
  expect_equal(to_multilevel(as_igraph(mpn_elite_usa_advice)), as_igraph(testmultilevel))
})

mat1 <- matrix(c(0,1,1,0,0,1,1,1),2,4)
mat2 <- matrix(c(2,1,1,3),2,2)
mat3 <- matrix(c(1,0,1,1,0,1,0,1,1,0,1,1,1,1,1,2),4,4)

test_that("matrix projected correctly by rows",{
  expect_equal(to_mode1(mat1), mat2)
  expect_true(igraph::is_weighted(to_mode1(ison_southern_women)))
  expect_true(is_graph(to_mode1(mpn_elite_usa_advice)))
  expect_error(to_mode1(as.data.frame(mat1)), "no applicable method")
})

test_that("matrix projected correctly by columns",{
  expect_equal(to_mode2(mat1), mat3)
  expect_true(is_weighted(to_mode2(ison_southern_women)))
  expect_true(is_graph(to_mode2(mpn_elite_usa_advice)))
  expect_error(to_mode2(as.data.frame(mat1)), "no applicable method")
})
