---
title: "Practical 4"
author: "James Hollway"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Practical 4}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

For this lab, we'll mostly rely on the `{igraph}` and `{migraph}` packages for analysis.
The data we're going to use is included in the `{migraph}` package

```{r setup}
suppressPackageStartupMessages(library(igraph))
suppressPackageStartupMessages(library(migraph))
data("ison_m182", package = "migraph")
# ?migraph::ison_m182
```

Note that you do not need to load the package using library() to get the data.
Now you know how to create new matrices in R, load .csv files, 
saved .RData files, and data from packages!

# Working with Multiplex Networks

This dataset is multiplex, meaning that it contains 
several different types of ties: friendship, social and task interactions.

The network is anonymous, but I think it would be nice to add some names,
even if it's just pretend. Luckily, I've added a function for this.
This makes plotting the network just a wee bit more accessible:

```{r addingnames}
ison_m182 <- to_named(ison_m182)
autographr(ison_m182)
```

There are actually three different types of tie here. 
Let's separate them out into separate networks.

```{r separatingnets}
(m182_friend <- to_uniplex(ison_m182, "friend_tie"))
gfriend <- autographr(m182_friend) + ggtitle("Friendship")
(m182_social <- to_uniplex(ison_m182, "social_tie"))
gsocial <- autographr(m182_social) + ggtitle("Social")
(m182_task <- to_uniplex(ison_m182, "task_tie"))
gtask <- autographr(m182_task) + ggtitle("Task")
grid.arrange(gfriend, gsocial, gtask, ncol = 3)
```

# Cohesion

Let's concentrate on the task network for now and calculate a few basic
measures of cohesion: density, reciprocity, transitivity, and components.

## Density

Because this is a directed network, 

```{r dens-explicit}
length(E(m182_task))/(length(V(m182_task))*(length(V(m182_task))-1))
```

but we can also just use the `{migraph}` function...

```{r dens}
graph_density(m182_task)
```

Same result? Is this high or low?

## Closure

Next let's calculate reciprocity.

```{r recip}
graph_reciprocity(m182_task)
```

Next let's calculate transitivity.

```{r trans}
graph_transitivity(m182_task)
```

What can we say about task closure in this network?

## Components

Now let's look at the friend network.

```{r comp-no}
graph_components(m182_friend)
graph_components(m182_friend, method = "strong")
```

How many components are there? Why?
 
We can use the membership vector in the resulting object to color nodes:

```{r comp-memb}
m182_friend <- m182_friend %>% 
  mutate(weak_comp = node_components(m182_friend),
         strong_comp = node_components(m182_friend, method = "strong"))
autographr(m182_friend, node_color = "weak_comp")
autographr(m182_friend, node_color = "strong_comp")
```

# Two-mode network: Southern women

The next dataset is also available in migraph.
Let's take a look at the loaded objects.

```{r setup-women}
data("southern_women")
southern_women
autographr(southern_women, node_color = "type")
```

## Project two-mode network into two one-mode networks

Now what if we are only interested in one part of the network?
For that, we can obtain a 'projection' of the two-mode network.
There are two ways of doing this.
The hard way...

```{r hardway}
twomode_matrix <- as_matrix(southern_women)
women_matrix <- twomode_matrix %*% t(twomode_matrix)
event_matrix <- t(twomode_matrix) %*% twomode_matrix
```

Or the easy way

```{r easyway}
women_graph <- project_rows(southern_women)
autographr(women_graph)
event_graph <- project_cols(southern_women)
autographr(event_graph)
```

Which women/events 'bind' which events/women?
Let's return to the question of cohesion.

```{r twomode-cohesion}
graph_equivalency(southern_women)
graph_transitivity(women_graph)
graph_transitivity(event_graph)
```

What do we learn from this?

# Task/Unit Test

1. What is the difference between communities and components?
2. Produce a plot comparing 3 community detection procedures used here on a 
(women) projection of the southern_women dataset. Identify which you prefer, and explain why.
3. Explain in no more than a paragraph why projection can lead to misleading transitivity measures.
4. Explain in no more than a paragraph how structural balance might lead to group identity.
