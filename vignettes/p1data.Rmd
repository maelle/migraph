---
title: "Practical 1"
author: "James Hollway"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Practical 1}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Working with network data

While `{migraph}` includes a number of datasets (see [here](https://snlab-ch.github.io/migraph/reference/index.html#section-data)),
and there are several packages in R that already include
a range of social network data,
there often comes a time when it is necessary to import and analyse data
from other sources.
Fortunately, `{migraph}` has a range of tools you can employ to import your data and manipulate it.

# Import data

`{migraph}` includes several functions that help 
read from (import) and write to (export) network data 
in a growing number of formats.

One format most users are long familiar with is Excel.
In Excel, users are typically collecting network data as edgelists, nodelists, or both.
Edgelists are typically the main object to be imported,
and we can import them from an Excel file or a `.csv` file.^[Note that if you import from a .csv file, please specify whether the separation value should be commas (`sv = "comma"`) or semi-colons (`sv = "semi-colon"`).]

```{r importedges, include = TRUE, eval = FALSE}
g1 <- read_edgelist("~Downloads/mynetworkdata.xlsx")
g1 <- read_edgelist("~Downloads/mynetworkdata.csv")
g1 <- read_edgelist()
n1 <- read_nodelist()
```

If you do not specify a particular file name, 
a helpful popup will open that assists you with locating and importing a file
from your operating system.
Importing a nodelist of nodal attributes operates very similarly.

In some cases, users will be faced with having to collect data themselves,
or wish to first manipulate the data in Excel before importing it,
but may be uncertain about the expected format of an edgelist.
Here it may be useful to try exporting one of the built-in datasets
in `{migraph}` to see how complete network data looks.
If this is potentially complex, 
calling `write_edgelist()` without any arguments will export a test
file with a barebones structure that you can overwrite with your own data.

```{r exportdata, include = FALSE, eval = FALSE}
write_edgelist(southern_women)
write_edgelist()
write_nodelist(southern_women)
write_nodelist()
```

There are other functions here too that help import from or export to
common external network data formats.
Here are some examples:

```{r otherimports, include = TRUE, eval = FALSE}
# for importing .net or .paj files
read_pajek()
write_pajek()
# for importing .##h files 
# (.##d files are automatically imported alongside)
read_ucinet()
write_ucinet()
```
  
# Converting between formats

By default, read and write edgelists and nodelists will import objects
into a data frame or tibble format or 'class' object,
and read and write pajek or ucinet will import objects into a
tidygraph class format

These can be already useful, as `{migraph}` functions work
with most main classes of network/graph objects in R: 
edgelists, matrices, igraph, tidygraph, and network objects.

However it is sometimes necessary to convert a given object from one type
or 'class' to another.

Once you have data imported into R, it may be necessary to change
its format 
  
If you prefer to work with the data as objects other than edgelist or tidygraph objects, they can also be easily converted into other formats using the `as_` functions in `{migraph}` that are discussed below. (Yay!) In a single step, objects are easily converted between several common classes of social network objects, including edgelists, matrices, igraphs, tidygraphs, and networks.
  
Some examples below:
  
```{as, include = TRUE, eval = FALSE}
as_edgelist(igraph1, weight = FALSE) # to convert 'igraph1' (an igraph object) to an edgelist object
as_matrix(igraph1, weight = TRUE) # to convert 'igraph1' (an igraph object) to a matrix object
as_igraph(matrix1, twomode = TRUE) # to convert 'matrix1' (a matrix object) to an igraph object
as_tidygraph(matrix1, twomode = FALSE) # to convert 'matrix1' (a matrix object) to a tidygraph object
as_network(igraph1, weight = FALSE) # to convert 'igraph1' (an igraph object) to a network object
```
  
Note that for converting into edgelist, matrix, or igraph objects, you can specify if you want to keep it as a weighted network (if your original data included this property) using the argument `weight = TRUE` or `weight = FALSE`.
For converting into igraph and tidygraph objects, there is the option of retaining the network as a two-mode network (keeping different types of nodes) or simplifying it into a one-mode network. Just specify it using the argument `twomode = TRUE` or `twomode = FALSE` respectively. 
  
## Combining data
  
We may also want to modify the structure or properties of our networks to facilitate analysis. Once again, this can be easily achieved in `{migraph}` using the `to_` and `add_` functions. All of the functions named below work on **igraph** and **tidygraph** objects, although some will also work on edgelist, matrix, and network objects.
  
### Multiplex and multilevel network data
  
If you want to include different types of ties in your network, `{migraph}` also contains functions that enable us to add edge and node attributes, constructing multiplex network data containing different types of ties from various objects. 
  
To insert additional edge attributes from another file/object, use `add_edge_attributes()` to copy edge attributes from another file/object into your network data. You can also use `mutate_edges()` to extract the edges from another network and insert them into your network as edge attributes.

`{migraph}` also contains functions to differentiate the nodes in your data. To add node attributes to your data from another file/object, use `add_node_attributes()` to input node attributes manually in R or use `copy_node_attributes()` to copy over node attributes from another file into your network.
For network data that includes different types of nodes and ties between and within these nodesets, we can also convert the data into a multilevel network structure easily using `to_multilevel()`.
  
Some examples:
  
```{multiplex, include = TRUE, eval = FALSE}
add_node_attributes(mynetwork, attribute_name, c("a", "b", "c")) # where c("a", "b", "c") is the vector of attributes you want to add to your network
copy_node_attributes(mynetwork, othernetwork) # where 'othernetwork' contains the attributes you want to add to your nodes
add_edge_attributes(mynetwork, othernetwork) # where 'othernetwork' contains the attributes you want to add to your edges
mutate_edges(mynetwork, othernetwork, attribute_name) # where 'othernetwork' contains the edges you want to add to your network as edge attributes
to_multilevel(mpn_elite_usa_advice)
```
    
### Simplifying network data
  
We can also simplify the network data using functions in `{migraph}`. 
`to_uniplex()` simplifies a network to contain only a single type of tie, while `to_simplex()` removes all loops or self-ties in the network. `to_onemode()` converts multimodal networks into networks with only one type of node and `to_main_component()` identifies and subsets the main component from a larger network, reducing the number of nodes and ties we are working with.

```{uniplex, include = TRUE, eval = FALSE}
to_onemode(ison_marvel_teams)
to_main_component(bignetwork)
to_uniplex(ison_m182, edge = "friend_tie") # include the argument 'edge = ' to specify the type of tie you want to retain
to_simplex(ison_m182)
```
  
### Basic properties of network data
  
To alter the properties of your network such as 'weights', 'signs', 'names' and 'directedness', just use the following `to_` functions (all named very intuitively!) to manipulate your network data. Remove weights using `to_unweighted`, remove signs using `to_unsigned()`, convert a directed network into an undirected one using `to_undirected`, or add/remove names using `to_named()`/`to_unnamed()` respectively.
  
```{combine, include = TRUE, eval = FALSE}
to_unweighted(mynetwork, threshold = 1) # `threshold = 1` converts weights beyond '1' into '1'
to_unnamed(ison_marvel_relationships)
to_undirected(directednetwork)
to_unsigned(ison_marvel_relationships, keep = c("positive", "negative")) # retain only one type of ties (positive OR negative)
to_named(ison_m182)
```
